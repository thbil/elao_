<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Elao_</title>

                    <!-- Open Graph / Facebook -->
             <meta property="og:title" content="Elao_" />
            <meta property="og:locale" content="fr" />
            <meta name="description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <meta property="og:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <link rel="canonical" href="https://elao.github.io/elao_/blog/dev/plusieurs-mailer-dans-une-application-symfony-2" />
            <meta property="og:url" content="https://elao.github.io/elao_/blog/dev/plusieurs-mailer-dans-une-application-symfony-2" />
            <meta property="og:site_name" content="elao_" />
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary">
            <meta property="twitter:title" content="Elao_">
            <meta property="twitter:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure.">
            <meta property="twitter:site" content="@tom32i">
            <meta property="twitter:creator" content="@tom32i">
                    
                    <link rel="stylesheet" href="/elao_/build/style.628c8aae.css">
            </head>
    <body>
        <header class="header">
            <div class="container">
                                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/">
                        <span class="screen-reader">Elao_</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>
                
                
                                    <!--
                        Todo :
                        - open / close mobile nav on click on .nav-toggle buttons
                        - when mobile nav is open, .body is .body.no-scroll to prevent background scroll
                     -->
                    <!-- Desktop nav -->
                    <nav class="nav">
                        <ul>
                                                            <li class="nav__item">
                                    <a href="/elao_/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                
                                    <!-- Mobile nav -->
                    <nav class="nav-mobile">
                        <div class="nav-mobile__header">
                            <a href="/elao_/">
                                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                            </a>
                            <button class="nav-toggle nav-toggle--close">
                                <i class="icon icon--close" aria-hidden="true"></i>
                                <span class="screen-reader">Fermer le menu</span>
                            </button>
                        </div>
                        <ul>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/etudes-de-cas/">
                                                                                <span>Nos études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                    <button class="nav-toggle nav-toggle--open">
                        <i class="icon icon--hamburger" aria-hidden="true"></i>
                        <span class="screen-reader">Ouvrir le menu</span>
                    </button>
                            </div>
        </header>
        <div class="container">
        <main>
              <img src="/elao_/images/posts/thumbnails/mailers.jpg" />

  <div>
    <img src="/elao_/images/authors/default.png" />
    <p>Écrit par Johan LOPES<p>
    <p>Publication 11 octobre 2013<p>
    <p>Modification 18 septembre 2020<p>
  </div>

  <div>
          <a href="/elao_/blog/tag/mailer">#mailer</a>
          <a href="/elao_/blog/tag/PHP">#PHP</a>
          <a href="/elao_/blog/tag/Symfony">#Symfony</a>
          <a href="/elao_/blog/tag/error-notifier-bundle">#error-notifier-bundle</a>
          <a href="/elao_/blog/tag/swift-mailer">#swift-mailer</a>
          <a href="/elao_/blog/tag/Mailer%20transport">#Mailer transport</a>
      </div>

  <div>
    <h1>Plusieurs mailer dans une application Symfony 2</h1>
    <p>Plusieurs mailer dans une application Symfony 2</p>
  </div>

  <div>
    <body><p>Voici une petite astuce que j'ai découvert hier et que j'ai pensé utile de partager !<!--more--></p>
<h1 id="probl-matique">Problématique<a href="#probl-matique" class="anchor"></a></h1>
<p><strong>Contexte :</strong></p>
<ul><li>Votre application Symfony2 utilise un service tiers pour envoyer vos e-mails (comme <a href="https://fr.mailjet.com/" target="_blank">Mailjet</a> par exemple)</li>
<li>Votre application a besoin d'envoyer des e-mails de notifications aux administrateurs lorsque des erreurs se produisent (Erreurs 500 par exemple)<!--more--></li>
</ul><p>Imaginez qu’une erreur se produise sur l’une de vos pages et que vous ayez des centaines d’utilisateurs en train de visualiser cette même page.Pour chaque affichage de cette dernière, vous allez recevoir un e-mail de notification.
Si ces e-mails passent par Mailjet par exemple, votre quota fondra à vue d’œil...
Au mieux vous atteindrez une limite de quota et les mails suivants seront bloqués, au pire vous ferez un énorme hors forfait qui pourra vous couter très cher...</p>
<h1 id="solution-propos-e">Solution proposée<a href="#solution-propos-e" class="anchor"></a></h1>
<p>La solution que je vous propose pour palier à cela est de créer 2 mailer utilisant 2 transports différents :</p>
<ul><li>Les e-mails classiques destinés aux utilisateurs de votre application passeront par votre serveur SMTP</li>
<li>Les e-mails techniques destinés aux administrateurs de votre application seront envoyés via la fonction mail de votre PHP.</li>
</ul><h1 id="mise-en-uvre-de-la-solution">Mise en œuvre de la solution<a href="#mise-en-uvre-de-la-solution" class="anchor"></a></h1>
<p>Pour cela rien de plus simple, créez plusieurs mailers dans votre app/config/config.yml :</p>
<code id="8ed9ff05059474544dd70b097e430e4f" class="language-yaml"><span class="token comment"># Swiftmailer Configuration</span>
<span class="token key atrule">swiftmailer</span><span class="token punctuation">:</span>
    <span class="token key atrule">default_mailer</span><span class="token punctuation">:</span> default
    <span class="token key atrule">mailers</span><span class="token punctuation">:</span>
        <span class="token key atrule">default</span><span class="token punctuation">:</span>
            <span class="token key atrule">transport</span><span class="token punctuation">:</span> smtp
            <span class="token key atrule">host</span><span class="token punctuation">:</span>      in.mailjet.com
            <span class="token key atrule">username</span><span class="token punctuation">:</span>  mylogin
            <span class="token key atrule">password</span><span class="token punctuation">:</span>  mypassword
        <span class="token key atrule">notifier</span><span class="token punctuation">:</span>
            <span class="token key atrule">transport</span><span class="token punctuation">:</span> mail</code>
<p>Vous remarquerez que cela aura pour effet de créer 2 services d'envoi d'e-mails que vous pourrez ensuite utiliser dans votre application :</p>
<code id="ff206c37f7781019d1aded89fd684fbe" class="language-bash">jlopes:/Volumes/Elao/workspace/myProject ./app/console container:debug <span class="token operator">|</span> <span class="token function">grep</span> mailer
mailer                                            n/a       <span class="token builtin class-name">alias</span> <span class="token keyword">for</span> swiftmailer.mailer.default
swiftmailer.mailer                                n/a       <span class="token builtin class-name">alias</span> <span class="token keyword">for</span> swiftmailer.mailer.default
swiftmailer.mailer.default                        container Swift_Mailer
swiftmailer.mailer.default.plugin.messagelogger   container Swift_Plugins_MessageLogger
swiftmailer.mailer.default.transport              container Swift_Transport_EsmtpTransport
swiftmailer.mailer.notifier                       container Swift_Mailer
swiftmailer.mailer.notifier.plugin.messagelogger  container Swift_Plugins_MessageLogger
swiftmailer.mailer.notifier.transport             container Swift_Transport_MailTransport
<span class="token punctuation">..</span>.</code>
<p>Cette astuce reste très simple mais je n'ai rien trouvé dans la documentation officielle de Symfony qui l'expliquait clairement. Elle peut se révéler très utile lorsque vous utilisez le bundle <strong><a href="https://github.com/Elao/ErrorNotifierBundle" target="_blank">ErrorNotifierBundle</a></strong></p>
<p>Merci et à bientôt !</p></body>
  </div>

  <div>
    <img src="/elao_/images/authors/default.png" />

    <p>Écrit par Johan LOPES<p>

          <a href=johan_lopes>Twitter</a>
              <a href=gfaivre>Github</a>
              <a href=http://www.elao.com>Website</a>
      </div>

  <h4>Ces articles pourraient vous intéresser:</h4>

        </main>
                    <footer class="footer">
                <section class="footer__links">
                    <p class="h1 h1--small">
                        elao
                        <span>développe</span>
                         <span>du lien</span>
                    </p>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="#">Nos services</a>
                            </li>
                            <li>
                                <a href="#">Nos études de cas</a>
                            </li>
                            <li>
                                <a href="#">Blog</a>
                            </li>
                            <li>
                                <a href="#">Notre méthodologie</a>
                            </li>
                            <li>
                                <a href="#">La tribu</a>
                            </li>
                            <li>
                                <a href="#">Contact</a>
                            </li>
                            <li>
                                <a href="#">Nos valeurs</a>
                            </li>
                            <li>
                                <a href="#">Nous recrutons <span class="bullet">3</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="socials">
                        <ul>
                            <li>
                                <a href="#">
                                    <i class="icon icon--github"></i>
                                    Github
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--twitter"></i>
                                    Twitter
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--instagram"></i>
                                    Instagram
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <section class="footer__legals">
                    <span>© 2014/2020 - ELAO - Tous droits réservés</span>
                    <a href="#">Mentions légales</a>
                    <a href="#">Protection des données</a>
                </section>
            </footer>
        </div>
                            <script src="/elao_/build/runtime.3ea599f4.js"></script><script src="/elao_/build/app.a7244376.js"></script>
                    </body>
</html>
