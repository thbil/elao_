<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Elao_</title>

                    <!-- Open Graph / Facebook -->
             <meta property="og:title" content="Elao_" />
            <meta property="og:locale" content="fr" />
            <meta name="description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <meta property="og:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/42/blog/dev/no-index-staging-symfony" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/42/blog/dev/no-index-staging-symfony" />
            <meta property="og:site_name" content="elao_" />
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary">
            <meta property="twitter:title" content="Elao_">
            <meta property="twitter:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure.">
            <meta property="twitter:site" content="@tom32i">
            <meta property="twitter:creator" content="@tom32i">
                    
                    <link rel="stylesheet" href="/elao_/pr/42/build/style.303f0a03.css">
            </head>
    <body>
        <header class="header">
            <div class="container">
                                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/42/">
                        <span class="screen-reader">Elao_</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>
                
                
                                    <!--
                        Todo :
                        - open / close mobile nav on click on .nav-toggle buttons
                        - when mobile nav is open, .body is .body.no-scroll to prevent background scroll
                     -->
                    <!-- Desktop nav -->
                    <nav class="nav">
                        <ul>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/42/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/42/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/42/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/42/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/42/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/42/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                
                                    <!-- Mobile nav -->
                    <nav class="nav-mobile">
                        <div class="nav-mobile__header">
                            <a href="/elao_/pr/42/">
                                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                            </a>
                            <button class="nav-toggle nav-toggle--close">
                                <i class="icon icon--close" aria-hidden="true"></i>
                                <span class="screen-reader">Fermer le menu</span>
                            </button>
                        </div>
                        <ul>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/pr/42/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/pr/42/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/pr/42/etudes-de-cas/">
                                                                                <span>Nos études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/pr/42/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/pr/42/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/pr/42/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item">
                                    <a href="/elao_/pr/42/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                    <button class="nav-toggle nav-toggle--open">
                        <i class="icon icon--hamburger" aria-hidden="true"></i>
                        <span class="screen-reader">Ouvrir le menu</span>
                    </button>
                            </div>
        </header>
        <div class="container">
        <main>
              <img src="/elao_/pr/42/images/posts/thumbnails/judging-sardine-small.jpg" />

  <div>
    <img src="/elao_/pr/42/images/authors/default.png" />
    <p>Écrit par La team Elao<p>
    <p>Publication 10 juillet 2019<p>
    <p>Modification 21 septembre 2020<p>
  </div>

  <div>
          <a href="/elao_/pr/42/blog/tag/Symfony">#Symfony</a>
          <a href="/elao_/pr/42/blog/tag/seo">#seo</a>
          <a href="/elao_/pr/42/blog/tag/no-index">#no-index</a>
      </div>

  <div>
    <h1>Comment empêcher les moteurs de recherche d&#039;indexer votre app Symfony en staging ?</h1>
    <p>Les pages de votre application n&#039;ont pas vocation à être présentes dans les moteurs de recherche ? Voici une courte explication pour vous aider à empêcher le crawl et l&#039;indexation.</p>
  </div>

  <div>
    <body><p>L'indexation par les robots des moteurs de recherche des urls de staging ou de démonstration sont des cas classiques de <a href="https://www.webrankinfo.com/dossiers/conseils/horreurs-du-seo" target="_blank">#SEOHorrorStories</a>. En effet, cette situation est gênante, pour deux raisons :</p>
<ul><li>L'entreprise ne souhaite probablement pas exposer à ses concurrents ou aux curieux du travail en cours,</li>
<li>Le contenu relatif à l'entreprise est disponible sous plusieurs urls, induisant un fort risque de dilution de la pertinence du contenu du site "officiel", puisque celui-ci peut être proposé sur deux pages différentes (c'est ce qu'on appelle la duplication de contenu).</li>
</ul><p>Voyons ensemble <strong>quelques solutions pour ne pas indexer les pages publiques de nos applicatifs</strong>, si nous n'en avons pas besoin.</p>
<h2 id="les-meilleures-solutions-l">Les meilleures solutions 💡: l'authentification côté serveur et le filtre par IP<a href="#les-meilleures-solutions-l" class="anchor"></a></h2>
<p>Le meilleur moyen d'empêcher tout crawl des robots et visites des internautes est d'<strong>imposer une authentification côté serveur</strong>. Une autre bonne solution est de filtrer l'accès au site selon l'IP, c'est à dire qu'on autorise l'affichage que si vous y êtes autorisés.
Bien sûr, dans les deux cas, les robots ne peuvent pas accéder aux pages, empêchant de ce fait tout risque de crawl et donc d'indexation.</p>
<p>Néanmoins, ces deux solutions peuvent parfois entraîner de nombreuses contraintes, par exemple si vous utilisez différents sous-domaines pour vos assets ou pour vos apis. La recette peut alors se compliquer sur les features les plus importantes du site.</p>
<h3 id="le-plan-b-l-en-t-te-de-r">Le plan B 👍 : l'en-tête de réponse HTTP<a href="#le-plan-b-l-en-t-te-de-r" class="anchor"></a></h3>
<p>Cette <strong>instruction X-Robots-Tag indiquera aux robots de ne pas indexer la page</strong>. Attention, cette méthode ne doit pas être couplée avec une directive de disallow de l'intégralité du robots.txt, puisque les bots n'auraient jamais accès à ce tag.</p>
<p>Une des variantes est la balise meta robots noindex, <a href="&lt;https://support.google.com/webmasters/answer/93710?hl=fr&gt;" target="_blank">c'est une des solutions décrites par Google dans sa documentation officielle</a>.</p>
<h3 id="comment-param-trer-ce-tag-sur-s">Comment paramétrer ce tag sur Symfony ?<a href="#comment-param-trer-ce-tag-sur-s" class="anchor"></a></h3>
<p>Depuis Symfony 4.3, <a href="https://symfony.com/blog/new-in-symfony-4-3-automatic-search-engine-protection" target="_blank">une configuration</a> permet d'ajouter automatiquement le header <span class="inline-code">X-Robots-Tag: noindex</span> aux réponses de Symfony.</p>
<code id="c3fe005ec8c78f177157f61dc8716a63"># config/packages/framework.yaml
framework:
    disallow_search_engine_index: true</code>
<p>Néanmoins, <strong>vous ne pouvez modifier cette configuration qu'en fonction de l'environnement Symfony</strong> (<span class="inline-code">dev</span>, <span class="inline-code">prod</span>, <span class="inline-code">test</span>, ...), et non en fonction du serveur. L'idée serait d'ajouter ce header sur les serveurs de staging, demo ou recette par exemple, et de ne pas l'ajouter sur le serveur de production, peu importe l'environnement Symfony qui est utilisé.</p>
<p>Malheureusement, <strong>cette configuration ne peux pas être pilotée par une variable d'environnement</strong> car elle impacte directement le container (définition d'un listener) et Symfony ne permet pas de faire cela au runtime. Je conseille donc de ne pas utiliser cette configuration.</p>
<p>La solution est de passer par la configuration <strong>nginx</strong> ou <strong>Apache</strong> de votre serveur pour ajouter le header. Par exemple avec nginx:</p>
<code id="c5258a060d3fdfcded375136410e638d">server {
    ...
    add_header X-Robots-Tag "noindex";
    ...
}</code>
<p>Et avec Apache (sous réserve que le mod header soit activé) :</p>
<code id="3aab7872f2d2bda5de12f1086b44b205">...
SetEnv X-Robots-Tag noindex
...</code>
<p>Cette solution a l'avantage de fonctionner <strong>peu importe la version de Symfony, le framework ou le langage utilisé par votre application</strong>. De plus, elle ne pourra pas être désactivée lors d'un mauvais déploiement.</p>
<h2 id="la-chose-ne-pas-faire">La chose à ne pas faire 🙅‍♀️ : interdire l'indexation via le robots.txt<a href="#la-chose-ne-pas-faire" class="anchor"></a></h2>
<p>Grâce à la directive <span class="inline-code">disallow</span>, on pense pouvoir empêcher les robots de visiter et d'indexer les pages de notre site. Mais ce n'est pas tout à fait l'objectif de <span class="inline-code">disallow</span>, <strong>qui n'empêche pas l'indexation mais le crawl</strong>. Résultat : vous pouvez retrouver des pages indexées dans les moteurs de recherche, même si le robot ne remonte ni meta description, ni title. Vous pouvez ainsi lire le fameux message :</p>
<p><span class="inline-code">A description for this result is not available because of this sites's robots.txt</span></p>
<p>De plus, il n'est pas rare de trouver en production des fichiers <span class="inline-code">robots.txt</span> paramétrés pour le staging, car ils auraient été oubliés lors de la mise en production 🙀.</p>
<p>Bon à savoir : la directive Noindex, qui était rarement utilisée, <a href="&lt;https://webmasters.googleblog.com/2019/07/a-note-on-unsupported-rules-in-robotstxt.html&gt;" target="_blank">a été officiellement abandonnée par Google</a>.</p>
<h2 id="oups-mon-site-avec-des-urls-de">Oups, mon site avec des urls de staging a été indexé ...<a href="#oups-mon-site-avec-des-urls-de" class="anchor"></a></h2>
<p>Faites le nécessaire pour empêcher les futures visites de robots. Vous pouvez ensuite utiliser <a href="https://www.google.com/webmasters/tools/removals" target="_blank">l'outil de suppression d'URL de la Search Console</a>, et demander la suppression des URLs problématiques.</p></body>
  </div>

  <div>
    <img src="/elao_/pr/42/images/authors/default.png" />

    <p>Écrit par La team Elao<p>

          <a href=Elao>Twitter</a>
              <a href=Elao>Github</a>
              <a href=http://www.elao.com>Website</a>
      </div>

  <h4>Ces articles pourraient vous intéresser:</h4>

        </main>
                    <footer class="footer">
                <section class="footer__links">
                    <p class="h1 h1--small">
                        elao
                        <span>développe</span>
                         <span>du lien</span>
                    </p>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="#">Nos services</a>
                            </li>
                            <li>
                                <a href="#">Nos études de cas</a>
                            </li>
                            <li>
                                <a href="#">Blog</a>
                            </li>
                            <li>
                                <a href="#">Notre méthodologie</a>
                            </li>
                            <li>
                                <a href="#">La tribu</a>
                            </li>
                            <li>
                                <a href="#">Contact</a>
                            </li>
                            <li>
                                <a href="#">Nos valeurs</a>
                            </li>
                            <li>
                                <a href="#">Nous recrutons <span class="bullet">3</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="socials">
                        <ul>
                            <li>
                                <a href="#">
                                    <i class="icon icon--github"></i>
                                    Github
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--twitter"></i>
                                    Twitter
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--instagram"></i>
                                    Instagram
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <section class="footer__legals">
                    <span>© 2014/2020 - ELAO - Tous droits réservés</span>
                    <a href="#">Mentions légales</a>
                    <a href="#">Protection des données</a>
                </section>
            </footer>
        </div>
                            <script src="/elao_/pr/42/build/runtime.fba8f3d8.js"></script><script src="/elao_/pr/42/build/app.a7244376.js"></script>
                    </body>
</html>
