<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Elao_</title>

                    <!-- Open Graph / Facebook -->
             <meta property="og:title" content="Elao_" />
            <meta property="og:locale" content="fr" />
            <meta name="description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <meta property="og:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/71/blog/dev/subdomains-symfony2-2-session-authentication.en" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/71/blog/dev/subdomains-symfony2-2-session-authentication.en" />
            <meta property="og:site_name" content="elao_" />
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary">
            <meta property="twitter:title" content="Elao_">
            <meta property="twitter:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure.">
            <meta property="twitter:site" content="@tom32i">
            <meta property="twitter:creator" content="@tom32i">
                    
                    <link rel="stylesheet" href="/elao_/pr/71/build/style.a131d065.css">
            </head>
    <body>
        <header class="header">
            <div class="container">
                                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/71/">
                        <span class="screen-reader">Elao_</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>
                
                
                                    <!-- Desktop nav -->
                    <nav class="nav">
                        <ul>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/71/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/71/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/71/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/71/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/71/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/71/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                
                                    <!-- Mobile nav -->
                    <nav class="nav-mobile">
                        <div class="nav-mobile__header">
                            <a href="/elao_/pr/71/">
                                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                            </a>
                            <button class="nav-toggle nav-toggle--close">
                                <i class="icon icon--close" aria-hidden="true"></i>
                                <span class="screen-reader">Fermer le menu</span>
                            </button>
                        </div>
                        <ul>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/71/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/71/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/71/etudes-de-cas/">
                                                                                <span>Nos études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/71/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/71/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/71/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item nav-mobile__item--large">
                                    <a href="/elao_/pr/71/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                    <button class="nav-toggle nav-toggle--open">
                        <i class="icon icon--hamburger" aria-hidden="true"></i>
                        <span class="screen-reader">Ouvrir le menu</span>
                    </button>
                            </div>
        </header>
        <div class="container">
        <main>
              <ul class="breadcrumb">
    <li class="breadcrumb__item">
      <a href="/elao_/pr/71/blog/">Blog</a>
    </li>
    <li class="breadcrumb__item">
      Feedback on a side-effect with Symfony 2.2, subdomains and sessions
    </li>
  </ul>

  <div class="article-banner">
    <div class="article-banner__cover" style="background: #f1f1f1 url(/elao_/pr/71/images/posts/thumbnails/turtle.jpg)"></div>

    <div class="article-info">
                    <div class="article-author ">
          <div class="article-author__image">
                          <img src="/elao_/pr/71/images/authors/tbessoussa.jpg" />
                      </div>
          <span class="article-author__info">
            Écrit par
                          <strong>Tristan BESSOUSSA</strong>
                      </span>
        </div>
            <div class="article-info__date">
        <span>Publication <strong>28 février 2013</strong></span>
        <span>Modification <strong>7 janvier 2021</strong></span>
      </div>
    </div>

    <div class="article-header">
      <h1>Feedback on a side-effect with Symfony 2.2, subdomains and sessions</h1>
      <p>Feedback on a side-effect with Symfony 2.2, subdomains and sessions</p>
      <ul class="article-tag-list">
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/71/blog/tag/Symfony">#Symfony</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/71/blog/tag/PHP">#PHP</a>
          </li>
              </ul>
    </div>
  </div>

  
  <div class="article-content">
    <main class="article-content__main">
      <body><p>This is a small feedback regarding the new Symfony 2.2 feature which makes the subdomains handling easier. By the way you can see the official documentation about <a style="text-align: justify;" href="http://symfony.com/doc/master/components/routing/hostname_pattern.html" target="_blank">routing &amp; subdomains here</a>.</p>
<h3 id="scenario">Scenario</h3>
<p>With the support of subdomains in the Symfony 2.2 routing component, you're all excited and decide to take advantage of that feature.</p>
<h3 id="problem-1">Problem 1</h3>
<p>Once you've opened one or more dedicated routes involving a subdomain, your users keep complaining about your application asking them to re-auth although they did it 5 minutes ago. Yeah, that's right, the session isn't shared across main domain and the subdomain.</p>
<p><strong>Cause :</strong> You forgot to set the path of the session cookie to a value that allows session sharing for all your subdomains too. By default, the value of <em>cookie_domain</em> takes the current domain from <code class="code-inline" id="74cf5004d8aceafd2531cc620a36c278">$_SERVER</code> superglobal (which will in most case will output www.my-domain.com).</p>
<p><strong>Solution :</strong> Add to your config.yml under the <em>session</em> key <code class="code-inline" id="2e290ec383073b4dbe58c4c051c94660">cookie_domain : .my-domain.com</code>. Just see the gist below for the example. If you use the <code class="code-inline" id="ea2bff02d99c26cb38c1b87b2a434604">remember_me</code> feature, don't forget to change the domain value of <code class="code-inline" id="9818925d214309e5b3cbbee315600a8a">security.yml</code> (see the 2nd gist).</p>
<h3 id="problem-2">Problem 2</h3>
<p>Once you've deployed the fix on your dev-preprod-prod server (choose the right stage according whether you like risks or not), you keep trying to login with your credentials without being actually logged in (and of course, no errors are logged).</p>
<p><strong>Cause :</strong> If you open any tool which let us visualize the cookies stored by a website, you'll figure out soon that you have 2 cookies <code class="code-inline" id="754d3b148df7a597947f5556cbe06628">PHPSESSID</code> with differents values in the domain (one with www.my-domain.com and the other with .my-domain.com).</p>
<p><strong>Solution :</strong> Change the name of the session cookie. It will prevent conflicts which will lead to a silent login failure.</p>
<p>There you are, with your subdomain ready application. Enjoy.</p>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="35f6016f8ec9203fae2f4577c9586438"><span class="token key atrule">framework</span><span class="token punctuation">:</span>
    <span class="token key atrule">esi</span><span class="token punctuation">:</span>             <span class="token punctuation">{</span> <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token punctuation">}</span>
    <span class="token key atrule">translator</span><span class="token punctuation">:</span>      <span class="token punctuation">{</span> <span class="token key atrule">fallback</span><span class="token punctuation">:</span> %locale% <span class="token punctuation">}</span>
    <span class="token key atrule">secret</span><span class="token punctuation">:</span>          %secret%
    <span class="token key atrule">router</span><span class="token punctuation">:</span>
        <span class="token key atrule">resource</span><span class="token punctuation">:</span> <span class="token string">"%kernel.root_dir%/config/routing.yml"</span>
        <span class="token key atrule">strict_requirements</span><span class="token punctuation">:</span> %kernel.debug%
    <span class="token key atrule">form</span><span class="token punctuation">:</span>            <span class="token null important">~</span>
    <span class="token key atrule">csrf_protection</span><span class="token punctuation">:</span> <span class="token null important">~</span>
    <span class="token key atrule">validation</span><span class="token punctuation">:</span>      <span class="token punctuation">{</span> <span class="token key atrule">enable_annotations</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token punctuation">}</span>
    <span class="token key atrule">templating</span><span class="token punctuation">:</span>
        <span class="token key atrule">engines</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'twig'</span><span class="token punctuation">]</span>
        <span class="token comment">#assets_version: SomeVersionScheme</span>
    <span class="token key atrule">default_locale</span><span class="token punctuation">:</span>  <span class="token string">"%locale%"</span>
    <span class="token key atrule">trusted_proxies</span><span class="token punctuation">:</span> <span class="token null important">~</span>
    <span class="token key atrule">session</span><span class="token punctuation">:</span>
        <span class="token key atrule">cookie_lifetime</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token key atrule">save_path</span><span class="token punctuation">:</span> %kernel.root_dir%/var/sessions
        <span class="token key atrule">cookie_domain</span><span class="token punctuation">:</span> .my<span class="token punctuation">-</span>domain.com
        <span class="token key atrule">name</span><span class="token punctuation">:</span> SFSESSID
    <span class="token key atrule">fragments</span><span class="token punctuation">:</span>       <span class="token null important">~</span></code></pre>
<pre class="code-multiline language-yaml"><code class="language-yaml" id="c60f5534308853b7fadbe471bf3eddca"><span class="token key atrule">main</span><span class="token punctuation">:</span>
    <span class="token key atrule">remember_me</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span>      <span class="token string">"%secret%"</span>
        <span class="token key atrule">lifetime</span><span class="token punctuation">:</span> <span class="token number">31536000</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span>     /
        <span class="token key atrule">domain</span><span class="token punctuation">:</span>   .my<span class="token punctuation">-</span>domain.com <span class="token comment"># Defaults to the current domain from $_SERVER</span></code></pre></body>
                        </main>
    <aside class="article-content__aside">
      <button class="kudo">
        <span class="kudo__button" aria-hidden="true"></span>
        <span class="screen-reader">Cet article m’a été utile</span>
        <span class="kudo__label" aria-hidden="true">Kudos</span>
      </button>
    </aside>
  </div>

  <div class="article-footer">
                  <div class="article-author">
          <div class="article-author__image">
            <img src="/elao_/pr/71/images/authors/tbessoussa.jpg" />
          </div>
          <span class="article-author__info">
            Écrit par
            <strong>Tristan BESSOUSSA</strong>
          </span>
          <div class="article-author__social">
                          <a href="https://twitter.com/sf_tristanb" class="social social--small">
                <i class="icon icon--twitter" aria-hidden="true"></i>
                <span class="screen-reader">Compte twitter de Tristan BESSOUSSA</span>
              </a>
                                      <a href="https://github.com/tristanbes "class="social social--small">
                <i class="icon icon--github" aria-hidden="true"></i>
                <span class="screen-reader">Compte github de Tristan BESSOUSSA</span>
              </a>
                                      <a href="http://www.elao.com" class="social social--small">
                <i class="icon icon--website" aria-hidden="true"></i>
                <span class="screen-reader">Site personnel de Tristan BESSOUSSA</span>
              </a>
                      </div>
        </div>
            </div>
        </main>
                    <footer class="footer">
                <section class="footer__links">
                    <p class="h1 h1--small">
                        elao
                        <span>développe</span>
                         <span>du lien</span>
                    </p>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="/elao_/pr/71/nos-services">Nos services</a>
                            </li>
                            <li>
                                <a href="/elao_/pr/71/etudes-de-cas/">Nos études de cas</a>
                            </li>
                            <li>
                                <a href="/elao_/pr/71/blog/">Blog</a>
                            </li>
                            <li>
                                <a href="/elao_/pr/71/methodo">Notre méthodologie</a>
                            </li>
                            <li>
                                <a href="/elao_/pr/71/la-tribu/">La tribu</a>
                            </li>
                            <li>
                                <a href="/elao_/pr/71/contact">Contact</a>
                            </li>
                            <li>
                                <a href="/elao_/pr/71/nos-valeurs">Nos valeurs</a>
                            </li>
                            <li>
                                                                <a href="/elao_/pr/71/recrutement/">
                                    Nous recrutons
                                                                            <span class="bullet">2</span>
                                                                    </a>
                            </li>
                        </ul>
                    </div>
                    <div class="socials">
                        <ul>
                            <li>
                                <a href="https://github.com/elao">
                                    <i class="icon icon--github"></i>
                                    Github
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/elao">
                                    <i class="icon icon--twitter"></i>
                                    Twitter
                                </a>
                            </li>
                            <li>
                                <a href="https://www.instagram.com/elao_agency/">
                                    <i class="icon icon--instagram"></i>
                                    Instagram
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <section class="footer__legals">
                    <span>© 2014/2021 - ELAO - Tous droits réservés</span>
                    <a href="/elao_/pr/71/legal">Mentions légales</a>
                    <a href="/elao_/pr/71/privacy">Protection des données</a>
                </section>
            </footer>
        </div>
                            <script src="/elao_/pr/71/build/runtime.ea406071.js"></script><script src="/elao_/pr/71/build/0.4fc588e5.js"></script><script src="/elao_/pr/71/build/app.67723742.js"></script>
                    </body>
</html>
