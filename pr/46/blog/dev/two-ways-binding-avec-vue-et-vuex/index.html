<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Elao_</title>

                    <!-- Open Graph / Facebook -->
             <meta property="og:title" content="Elao_" />
            <meta property="og:locale" content="fr" />
            <meta name="description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <meta property="og:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/46/blog/dev/two-ways-binding-avec-vue-et-vuex" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/46/blog/dev/two-ways-binding-avec-vue-et-vuex" />
            <meta property="og:site_name" content="elao_" />
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary">
            <meta property="twitter:title" content="Elao_">
            <meta property="twitter:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure.">
            <meta property="twitter:site" content="@tom32i">
            <meta property="twitter:creator" content="@tom32i">
                    
                    <link rel="stylesheet" href="/elao_/pr/46/build/style.feddf193.css">
            </head>
    <body>
        <header class="header">
            <div class="container">
                                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/46/">
                        <span class="screen-reader">Elao_</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>
                
                
                                    <!-- Desktop nav -->
                    <nav class="nav">
                        <ul>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/46/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/46/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/46/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/46/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/46/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/46/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                
                                    <!-- Mobile nav -->
                    <nav class="nav-mobile">
                        <div class="nav-mobile__header">
                            <a href="/elao_/pr/46/">
                                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                            </a>
                            <button class="nav-toggle nav-toggle--close">
                                <i class="icon icon--close" aria-hidden="true"></i>
                                <span class="screen-reader">Fermer le menu</span>
                            </button>
                        </div>
                        <ul>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/46/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/46/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/46/etudes-de-cas/">
                                                                                <span>Nos études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/46/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/46/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/46/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item nav-mobile__item--large">
                                    <a href="/elao_/pr/46/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                    <button class="nav-toggle nav-toggle--open">
                        <i class="icon icon--hamburger" aria-hidden="true"></i>
                        <span class="screen-reader">Ouvrir le menu</span>
                    </button>
                            </div>
        </header>
        <div class="container">
        <main>
              <ul class="breadcrumb">
    <li class="breadcrumb__item">
      <a href="/elao_/pr/46/blog/">Blog</a>
    </li>
    <li class="breadcrumb__item">
      Two Way-Binding avec Vue et Vuex
    </li>
  </ul>

  <div class="article-banner">
    <div class="article-banner__cover" style="background: #f1f1f1 url(/elao_/pr/46/images/posts/thumbnails/vuejs.jpg)"></div>

    <div class="article-info">
                    <div class="article-author ">
          <div class="article-author__image">
                          <img src="/elao_/pr/46/images/authors/mcolin.jpg" />
                      </div>
          <span class="article-author__info">
            Écrit par
                          <strong>Maxime COLIN</strong>
                      </span>
        </div>
            <div class="article-info__date">
        <span>Publication <strong>25 septembre 2019</strong></span>
        <span>Modification <strong>29 septembre 2020</strong></span>
      </div>
    </div>

    <div class="article-header">
      <h1>Two Way-Binding avec Vue et Vuex</h1>
      <p>Mise en place d&#039;un Two-Way Binding avec Vue et Vuex.</p>
      <ul class="article-tag-list">
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/46/blog/tag/Vuejs">#Vuejs</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/46/blog/tag/Javascript">#Javascript</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/46/blog/tag/Front">#Front</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/46/blog/tag/Frontend">#Frontend</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/46/blog/tag/Framework">#Framework</a>
          </li>
              </ul>
    </div>
  </div>

  
  <div class="article-content">
    <main class="article-content__main">
      <body><p>Vue permet déjà de faire du Two-Way Binding grâce à la directive <code class="code-inline" id="088dc68c3dcfc8e6946dcc4faab5b96c">v-model</code>. C'est à dire mettre à jour l'interface lorsque le modèle change et vice et versa.</p>
<pre class="code-multiline"><code id="d0d1334c3aed16d3f8d0b995a3609c28">&lt;script&gt;
export default {
  data() {
    return {
      foobar: 'Lorem ipsum'
    }
  }
}
&lt;/script&gt;

&lt;template&gt;
  &lt;form&gt;
    &lt;input type="text" v-model="foobar" /&gt;
  &lt;/form&gt;
&lt;/template&gt;</code></pre>
<p>Dans ce composant par exemple, lorsque la variable <code class="code-inline" id="3858f62230ac3c915f300c664312c63f">foobar</code> est modifié, le contenu du champ est mis à jour et lorsque le contenu du champ est modifié, la variable <code class="code-inline" id="3858f62230ac3c915f300c664312c63f">foobar</code> est modifiée.</p>
<p>Si nous introduisons Vuex (ou un autre state manager), les variables du store n'étant pas modifiable par les composants, nous ne pouvons faire que du One-Way Binding (lorsque le modèle change, l'interface est mise à jour, l'inverse n'est pas possible).</p>
<pre class="code-multiline"><code id="39a1a60cb6d14683ddcbfab2f6226254">&lt;template&gt;
  &lt;form&gt;
    &lt;input type="text" v-model="$store.state.foobar" /&gt;
  &lt;/form&gt;
&lt;/template&gt;</code></pre>
<p>Un composant comme celui-ci par exemple violerait le principe selon lequel les variables du store ne peuvent être modifiées que par une mutation et jamais directement. Vous obtiendrez d'ailleurs un warning de la part de Vue.</p>
<p>La solution pour faire du Two-Way Binding est donc d'utiliser un computed avec un getter et un setter. Le getter renvoie la valeur stockée dans le store et le setter met à jour le store grâce à une mutation.</p>
<pre class="code-multiline"><code id="98ed0fb82a15daf43632e56ca22e1b32">&lt;script&gt;
export default {
  computed: {
    foobar: {
      get() { return this.$store.state.foobar },
      set(value) { this.$store.commit('UPDATE_FOOBAR', value) }
    }
  }
}
&lt;/script&gt;

&lt;template&gt;
  &lt;form&gt;
    &lt;input type="text" v-model="foobar" /&gt;
  &lt;/form&gt;
&lt;/template&gt;</code></pre>
<p>On retrouve alors un Two-Way Binding tout en respectant le principe de non modification directe du state.</p>
<p>L'ennui avec cette méthode est qu'elle nécessite autant de getter/setter que de champs, ce qui peut vite vous amener à écrire beaucoup de code lorsque vous avez de gros formulaires. Je vous propose une astuce pour simplifier tout ça.</p>
<p>On va s'inspirer des helpers <code class="code-inline" id="efde5407efde52376a9d88b23cf1bd7b">mapState</code>, <code class="code-inline" id="5983f2437b4348c81ebc76032eaa6c8b">mapGetters</code> et <code class="code-inline" id="bb015b733b7fcdbbf57dee47b7a5a4ab">mapActions</code> de Vuex.</p>
<p>Par exemple :</p>
<pre class="code-multiline"><code id="36428d8c65b77e03c231a648957169f8">&lt;script&gt;
export default {
  computed: {
    ...mapState(['foobar', 'barfoo'])
  }
}
&lt;/script&gt;</code></pre>
<p>Permet d'obtenir le même résultat que :</p>
<pre class="code-multiline"><code id="e7f1b87671584c45777912fd3e7ff328">&lt;script&gt;
export default {
  computed: {
    foobar() {
      return this.$store.state.foobar
    },
    barfoo() {
      return this.$store.state.barfoo
    }
  }
}
&lt;/script&gt;</code></pre>
<p>Cela permet de réduire considérablement la quantité de code lorsque l'on a un grand nombre de variables à mapper. On va donc créer une fonction similaire à <code class="code-inline" id="efde5407efde52376a9d88b23cf1bd7b">mapState</code> qui ne va pas seulement créer de simples <code class="code-inline" id="5a317d3dd3f7a2f675975a6d0c11c629">computed</code> mais également les getters et setters nécessaires au Two-Way Binding.</p>
<pre class="code-multiline"><code id="f8e2b8fc8eb660903d7cc8996bf99a47">function mapFields(fields) {
  let computeds = {}

  for (field of fields) {
    computeds[field] = {
      get() {
        return this.$store.state[field]
      },
      set(value) {
        this.$store.commit('UPDATE_' + field.toUpperCase(), value)
      }
    }
  }

  return computeds
}</code></pre>
<p>Vous pouvez désormais utiliser cette fonction avec le <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/Syntaxe_d%C3%A9composition" target="_blank">spread operator</a> pour générer vos computed properties.</p>
<pre class="code-multiline"><code id="10da1960e3dd5f74d021b36aeb610ab3">&lt;script&gt;
export default {
  computed: {
    ...mapFields(['foobar', 'barfoo'])
  }
}
&lt;/script&gt;

&lt;template&gt;
  &lt;form&gt;
    &lt;input type="text" v-model="foobar" /&gt;
    &lt;input type="text" v-model="barfoo" /&gt;
  &lt;/form&gt;
&lt;/template&gt;</code></pre>
<p>Ici, cela nécessite évidemment que vous disposiez des mutations pour chacune de vos variables nommées de la même façon (<code class="code-inline" id="277b85a1bf0deb91fba91f3f5a9fc664">UPDATE_FOOBAR</code> et <code class="code-inline" id="db06a11579f865e3288db6eeb8a3dd9f">UPDATE_BARFOO</code>).</p>
<pre class="code-multiline"><code id="2f0916608f1913a2e6b45d15a3d82947">new Vuex.Store({
  state: {
    foobar: null,
    barfoo: null,
  },
  mutation: {
    UPDATE_FOOBAR (state, value) { state.foobar = value },
    UPDATE_BARFOO (state, value) { state.barfoo = value },
  }
})</code></pre>
<p>Vous pouvez bien entendu complexifier cette fonction selon vos besoins et vos habitudes ou en créer plusieurs correspondant à vos différents use-cases. L'idée peut être même appliquée à d'autres cas que les computed et le <strong>two-way binding</strong>. On peut par exemple imaginer des fonctions pour générer des méthodes ou watchers.</p>
<pre class="code-multiline"><code id="f95e082d30e2e0b47c78bbaf268578ae">function mapWatcher(fields) {
  let watchers = {}

  for (field of fields) {
    watchers[field] = function (newValue) {
      this.$emit(`${field}_updated`, newValue)
    }
  }

  return watchers
}</code></pre>
<p>Cette fonction permet de créer un watcher qui émettra un événement à la modification pour chaque propriété passée en argument.</p>
<pre class="code-multiline"><code id="02da82502182bd5165d1a8cf84478118">export default {
  watch: {
    ...mapWatcher(['foobar', 'barfoo'])
  }
}</code></pre></body>
                        </main>
    <aside class="article-content__aside">
      <button class="kudo">
        <span class="kudo__button" aria-hidden="true"></span>
        <span class="screen-reader">Cet article m’a été utile</span>
        <span class="kudo__label" aria-hidden="true">Kudos</span>
      </button>
    </aside>
  </div>

  <div class="article-footer">
                  <div class="article-author">
          <div class="article-author__image">
            <img src="/elao_/pr/46/images/authors/mcolin.jpg" />
          </div>
          <span class="article-author__info">
            Écrit par
            <strong>Maxime COLIN</strong>
          </span>
          <div class="article-author__social">
                          <a href="https://twitter.com/colin_maxime" class="social social--small">
                <i class="icon icon--twitter" aria-hidden="true"></i>
                <span class="screen-reader">Compte twitter de Maxime COLIN</span>
              </a>
                                      <a href="https://github.com/maximecolin "class="social social--small">
                <i class="icon icon--github" aria-hidden="true"></i>
                <span class="screen-reader">Compte github de Maxime COLIN</span>
              </a>
                                      <a href="http://www.maximecolin.fr" class="social social--small">
                <i class="icon icon--website" aria-hidden="true"></i>
                <span class="screen-reader">Site personnel de Maxime COLIN</span>
              </a>
                      </div>
        </div>
            </div>
        </main>
                    <footer class="footer">
                <section class="footer__links">
                    <p class="h1 h1--small">
                        elao
                        <span>développe</span>
                         <span>du lien</span>
                    </p>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="#">Nos services</a>
                            </li>
                            <li>
                                <a href="#">Nos études de cas</a>
                            </li>
                            <li>
                                <a href="#">Blog</a>
                            </li>
                            <li>
                                <a href="#">Notre méthodologie</a>
                            </li>
                            <li>
                                <a href="#">La tribu</a>
                            </li>
                            <li>
                                <a href="#">Contact</a>
                            </li>
                            <li>
                                <a href="#">Nos valeurs</a>
                            </li>
                            <li>
                                <a href="#">Nous recrutons <span class="bullet">3</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="socials">
                        <ul>
                            <li>
                                <a href="#">
                                    <i class="icon icon--github"></i>
                                    Github
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--twitter"></i>
                                    Twitter
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--instagram"></i>
                                    Instagram
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <section class="footer__legals">
                    <span>© 2014/2020 - ELAO - Tous droits réservés</span>
                    <a href="#">Mentions légales</a>
                    <a href="#">Protection des données</a>
                </section>
            </footer>
        </div>
                            <script src="/elao_/pr/46/build/runtime.040c6f30.js"></script><script src="/elao_/pr/46/build/0.4fc588e5.js"></script><script src="/elao_/pr/46/build/app.67723742.js"></script>
                    </body>
</html>
