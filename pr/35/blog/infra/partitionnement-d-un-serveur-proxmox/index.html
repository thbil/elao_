<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Elao_</title>

                    <!-- Open Graph / Facebook -->
             <meta property="og:title" content="Elao_" />
            <meta property="og:locale" content="fr" />
            <meta name="description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <meta property="og:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/35/blog/infra/partitionnement-d-un-serveur-proxmox" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/35/blog/infra/partitionnement-d-un-serveur-proxmox" />
            <meta property="og:site_name" content="elao_" />
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary">
            <meta property="twitter:title" content="Elao_">
            <meta property="twitter:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure.">
            <meta property="twitter:site" content="@tom32i">
            <meta property="twitter:creator" content="@tom32i">
                    
                    <link rel="stylesheet" href="/elao_/pr/35/build/style.ac4e2eec.css">
            </head>
    <body>
        <header class="header">
            <div class="container">
                                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/35/">
                        <span class="screen-reader">Elao_</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>
                
                
                                    <!--
                        Todo :
                        - open / close mobile nav on click on .nav-toggle buttons
                        - when mobile nav is open, .body is .body.no-scroll to prevent background scroll
                     -->
                    <!-- Desktop nav -->
                    <nav class="nav">
                        <ul>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                
                                    <!-- Mobile nav -->
                    <nav class="nav-mobile">                        <div class="nav-mobile__header">
                            <a href="/elao_/pr/35/">
                                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                            </a>
                            <button class="nav-toggle nav-toggle--close">
                                <i class="icon icon--close" aria-hidden="true"></i>
                                <span class="screen-reader">Fermer le menu</span>
                            </button>
                        </div>
                        <ul>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/etudes-de-cas/">
                                                                                <span>Nos études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item nav-mobile__item--large">
                                    <a href="/elao_/pr/35/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                    <button class="nav-toggle nav-toggle--open">
                        <i class="icon icon--hamburger" aria-hidden="true"></i>
                        <span class="screen-reader">Ouvrir le menu</span>
                    </button>
                            </div>
        </header>
        <div class="container">
        <main>
              <ul class="breadcrumb">
    <li class="breadcrumb__item">
      <a href="#">Blog</a>
    </li>
    <li class="breadcrumb__item">
      <a href="#">Comprendre le cache du client Graphql Apollo</a>
    </li>
  </ul>

  <div class="article-banner">
    <div class="article-banner__cover" style="background: #f1f1f1 url(/elao_/pr/35/images/posts/thumbnails/hdd_partition.jpg)"></div>

    <div class="article-info">
      <!-- todo : this is if the article has a single author -->
      <div class="article-author">
        <div class="article-author__image">
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
        </div>
        <span class="article-author__info">Écrit par <strong>Guewen FAIVRE</strong></span>
      </div>
      <!-- todo : this is if the article has multiple authors -->
      <div class="article-author article-author--multi">
        <div class="article-author__image">
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
        </div>
        <span class="article-author__info">
          Écrit par
          <strong>Anne-Laure DE BOISSIEU</strong>
          <strong>Guewen FAIVRE</strong>
          <strong>Guewen FAIVRE</strong>
        </span>
      </div>
      <!-- todo : if the article has more than 5 co-authors (too long, won't fit) , "la team elao" is the author -->
      <div class="article-author">
        <div class="article-author__image">
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
        </div>
        <span class="article-author__info">Écrit par <strong>La team elao</strong></span>
      </div>
      <div class="article-info__date">
        <span>Publication <strong>6 novembre 2014</strong></span>
        <span>Modification <strong>24 septembre 2020</strong></span>
      </div>
    </div>

    <div class="article-header">
      <h1>Partitionnement d&#039;un serveur proxmox</h1>
      <p>Petit billet mémo aujourd&#039;hui concernant le partitionnement d&#039;un serveur Proxmox, rien de bien sorcier en soi mais il est toujours bon d&#039;avoir un référentiel auquel se fier.</p>
      <ul class="article-tag-list">
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/35/blog/tag/proxmox">#proxmox</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/35/blog/tag/openvz">#openvz</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/35/blog/tag/partitionnement">#partitionnement</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/35/blog/tag/linux">#linux</a>
          </li>
              </ul>
    </div>
  </div>

  <ul class="table-of-content">
    <li class="table-of-content__item">
      <a href="#intro">Introduction</a>
    </li>
    <li class="table-of-content__item">
      <a href="#quas">Quas odio atque</a>
    </li>
    <li class="table-of-content__item">
      <a href="voluptatem">Voluptatem et amet atque</a>
    </li>
  </ul>

  <div class="article-content">
    <main class="article-content__main">
      <body><p>Bonjour à tous,</p>
<p>Petit billet mémo aujourd'hui concernant le partitionnement d'un serveur Proxmox, rien de bien sorcier en soi mais il est toujours bon d'avoir un référentiel auquel se fier.<!--more--></p>
<p>Utilisant depuis un bon moment des solutions de virtualisation, nous avons pour habitude chez ELAO d'utiliser des containers OpenVZ via la distribution <a href="https://www.proxmox.com/" target="_blank">Proxmox</a>.</p>
<p>Nous prendrons pour l'exemple une des machines OVH, machines avec lesquelles nous avons l'habitude de travailler. Pour les moins exigeants le partitionnement par défaut proposé peut parfaitement faire l'affaire.</p>
<p class="text-center">
    {{}}
</p>
<p>Il présente cependant un gros défaut qui est celui de ne pas laisser d'espace non partitionné à disposition de Proxmox dans le groupe LV, condition <i>sine qua non</i> pour pouvoir effectuer des sauvegardes de type "snapshot" de nos containers (ou de nos machines virtuelles).</p>
<p>Pour rappel le backup "à chaud" sous Proxmox fonctionne de la façon suivante:</p>
<ul><li>Proxmox crée une partition virtuelle à la volée.</li>
<li>Il déclenche un premier rsync du container (ou de la VM) pour récupérer le "gros" des fichiers.</li>
<li>Il déclenche un deuxième rsync afin de mettre à jour les fichiers ayant été modifiés entre le début et la fin du premier.</li>
<li>Il crée une archive compressée qu'il stocke dans <code class="code-inline" id="c7b09ceecb85753c86cf7755d5939d52">/var/lib/vz/dump</code></li>
<li>Il détruit la partition virtuelle initialement créée</li>
</ul><p>Nous préférerons donc définir un partitionnement comme ci-dessous (La machine utilisée disposait d'un espace total de 3 To):</p>
<p class="text-center">
    ![Partitionnement-d-un-serveur-proxmox - Partitionnement personnalisé](/images/posts/2014/proxmox_partition_elao_1000.png)
</p>
<ul><li>500 Mo pour <code class="code-inline" id="a53bfb333437907a8d5bdc636d15c75d">/boot</code> (Devrait amplement suffire à couvrir les MAJ kernel)</li>
<li>10 Go pour <code class="code-inline" id="6666cd76f96956469e7be39d750cc7d9">/</code></li>
<li>2 * 1 Go pour le swap</li>
</ul><p>Le reste est partitionné avec du LVM ce qui nous laisse une grande souplesse pour éventuellement réallouer de l'espace disque.</p>
<ul><li>10 Go pour <code class="code-inline" id="d42b9c57d24cf5db3bd8d332dc35437f">/tmp</code> (Que l'on passe en tmpfs et pour laquelle on ajoute les options nodev, nosuid et noexec par sécurité)</li>
<li>1 To pour <code class="code-inline" id="6bc86eb322cf4593d00d57000367a45f">/var/lib/vz</code> qui va recevoir les VMs et Containers</li>
<li>150 Go pour <code class="code-inline" id="c7b09ceecb85753c86cf7755d5939d52">/var/lib/vz/dump</code> (Dans la pratique je ne l'utilise pas et préfère utiliser les 500 Go de backup externe fourni avec OVH pour chaque serveur dédié monté en NFS)</li>
</ul><p>Attention toutefois à conserver au moins 50 Go d'espace non partitionné pour pouvoir effectuer des snapshots, veuillez à adapter cette espace à la taille de votre plus grosse VM.</p>
<p>A cet espace nécessaire aux snapshots on gardera le reste de l'espace disque non partitionné pour pouvoir le redistribuer si jamais on se rend compte qu'une partition est trop petite.</p>
<p>Comme d'habitude, remarques et critiques de ce schéma sont plus que les bienvenues ;)</p></body>
    </main>
    <aside class="article-content__aside">
      <button class="kudo">
        <span class="kudo__button" aria-hidden="true"></span>
        <span class="screen-reader">Cet article m’a été utile</span>
        <span class="kudo__label" aria-hidden="true">Kudos</span>
      </button>
    </aside>
  </div>

  <div class="article-footer">
    <!-- If the article has one single author -->
    <div class="article-author">
      <div class="article-author__image">
        <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
      </div>
      <span class="article-author__info">Écrit par<strong>Guewen FAIVRE</strong></span>
      <div class="article-author__social">
                  <a href=guewen_faivre class="social social--small">
            <i class="icon icon--twitter" aria-hidden="true"></i>
            <span class="screen-reader">Compte twitter de Guewen FAIVRE</span>
          </a>
                          <a href=gfaivre class="social social--small">
            <i class="icon icon--github" aria-hidden="true"></i>
            <span class="screen-reader">Compte github de Guewen FAIVRE</span>
          </a>
                          <a href=http://www.elao.com class="social social--small">
            <i class="icon icon--website" aria-hidden="true"></i>
            <span class="screen-reader">Site personnel de Guewen FAIVRE</span>
          </a>
              </div>
    </div>
    <!-- If the article has mutltiple authors -->
    <div class="article-author">
      <div class="article-author__image">
        <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
      </div>
      <span class="article-author__info">Co-auteur<strong>Guewen FAIVRE</strong></span>
      <div class="article-author__social">
                  <a href=guewen_faivre class="social social--small">
            <i class="icon icon--twitter" aria-hidden="true"></i>
            <span class="screen-reader">Compte twitter de Guewen FAIVRE</span>
          </a>
                          <a href=gfaivre class="social social--small">
            <i class="icon icon--github" aria-hidden="true"></i>
            <span class="screen-reader">Compte github de Guewen FAIVRE</span>
          </a>
                          <a href=http://www.elao.com class="social social--small">
            <i class="icon icon--website" aria-hidden="true"></i>
            <span class="screen-reader">Site personnel de Guewen FAIVRE</span>
          </a>
              </div>
    </div>
    <div class="article-author">
      <div class="article-author__image">
        <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
      </div>
      <span class="article-author__info">Co-auteur<strong>Guewen FAIVRE</strong></span>
      <div class="article-author__social">
                  <a href=guewen_faivre class="social social--small">
            <i class="icon icon--twitter" aria-hidden="true"></i>
            <span class="screen-reader">Compte twitter de Guewen FAIVRE</span>
          </a>
                          <a href=gfaivre class="social social--small">
            <i class="icon icon--github" aria-hidden="true"></i>
            <span class="screen-reader">Compte github de Guewen FAIVRE</span>
          </a>
                          <a href=http://www.elao.com class="social social--small">
            <i class="icon icon--website" aria-hidden="true"></i>
            <span class="screen-reader">Site personnel de Guewen FAIVRE</span>
          </a>
              </div>
    </div>
  </div>

  
        </main>
                    <footer class="footer">
                <section class="footer__links">
                    <p class="h1 h1--small">
                        elao
                        <span>développe</span>
                         <span>du lien</span>
                    </p>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="#">Nos services</a>
                            </li>
                            <li>
                                <a href="#">Nos études de cas</a>
                            </li>
                            <li>
                                <a href="#">Blog</a>
                            </li>
                            <li>
                                <a href="#">Notre méthodologie</a>
                            </li>
                            <li>
                                <a href="#">La tribu</a>
                            </li>
                            <li>
                                <a href="#">Contact</a>
                            </li>
                            <li>
                                <a href="#">Nos valeurs</a>
                            </li>
                            <li>
                                <a href="#">Nous recrutons <span class="bullet">3</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="socials">
                        <ul>
                            <li>
                                <a href="#">
                                    <i class="icon icon--github"></i>
                                    Github
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--twitter"></i>
                                    Twitter
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--instagram"></i>
                                    Instagram
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <section class="footer__legals">
                    <span>© 2014/2020 - ELAO - Tous droits réservés</span>
                    <a href="#">Mentions légales</a>
                    <a href="#">Protection des données</a>
                </section>
            </footer>
        </div>
                            <script src="/elao_/pr/35/build/runtime.27a2bcc8.js"></script><script src="/elao_/pr/35/build/app.a7244376.js"></script>
                    </body>
</html>
