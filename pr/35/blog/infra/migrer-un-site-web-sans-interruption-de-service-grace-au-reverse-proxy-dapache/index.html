<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Elao_</title>

                    <!-- Open Graph / Facebook -->
             <meta property="og:title" content="Elao_" />
            <meta property="og:locale" content="fr" />
            <meta name="description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <meta property="og:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure." />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/35/blog/infra/migrer-un-site-web-sans-interruption-de-service-grace-au-reverse-proxy-dapache" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/35/blog/infra/migrer-un-site-web-sans-interruption-de-service-grace-au-reverse-proxy-dapache" />
            <meta property="og:site_name" content="elao_" />
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary">
            <meta property="twitter:title" content="Elao_">
            <meta property="twitter:description" content="Elao est un atelier de co-conception d&#039;applications web et mobile sur mesure.">
            <meta property="twitter:site" content="@tom32i">
            <meta property="twitter:creator" content="@tom32i">
                    
                    <link rel="stylesheet" href="/elao_/pr/35/build/style.cabec594.css">
            </head>
    <body>
        <header class="header">
            <div class="container">
                                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/35/">
                        <span class="screen-reader">Elao_</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>
                
                
                                    <!--
                        Todo :
                        - open / close mobile nav on click on .nav-toggle buttons
                        - when mobile nav is open, .body is .body.no-scroll to prevent background scroll
                     -->
                    <!-- Desktop nav -->
                    <nav class="nav">
                        <ul>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/35/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                
                                    <!-- Mobile nav -->
                    <nav class="nav-mobile">                        <div class="nav-mobile__header">
                            <a href="/elao_/pr/35/">
                                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                            </a>
                            <button class="nav-toggle nav-toggle--close">
                                <i class="icon icon--close" aria-hidden="true"></i>
                                <span class="screen-reader">Fermer le menu</span>
                            </button>
                        </div>
                        <ul>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/nos-services">
                                                                                <span>Nos services</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/methodo">
                                                                                <span>Notre méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/etudes-de-cas/">
                                                                                <span>Nos études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/nos-valeurs">
                                                                                <span>Nos valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/la-tribu/">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/35/blog/">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item nav-mobile__item--large">
                                    <a href="/elao_/pr/35/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                    <button class="nav-toggle nav-toggle--open">
                        <i class="icon icon--hamburger" aria-hidden="true"></i>
                        <span class="screen-reader">Ouvrir le menu</span>
                    </button>
                            </div>
        </header>
        <div class="container">
        <main>
              <ul class="breadcrumb">
    <li class="breadcrumb__item">
      <a href="#">Blog</a>
    </li>
    <li class="breadcrumb__item">
      <a href="#">Comprendre le cache du client Graphql Apollo</a>
    </li>
  </ul>

  <div class="article-banner">
    <div class="article-banner__cover" style="background: #f1f1f1 url(/elao_/pr/35/images/posts/thumbnails/pulp_starwars.png)"></div>

    <div class="article-info">
      <!-- todo : this is if the article has a single author -->
      <div class="article-author">
        <div class="article-author__image">
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
        </div>
        <span class="article-author__info">Écrit par <strong>Guewen FAIVRE</strong></span>
      </div>
      <!-- todo : this is if the article has multiple authors -->
      <div class="article-author article-author--multi">
        <div class="article-author__image">
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
        </div>
        <span class="article-author__info">
          Écrit par
          <strong>Anne-Laure DE BOISSIEU</strong>
          <strong>Guewen FAIVRE</strong>
          <strong>Guewen FAIVRE</strong>
        </span>
      </div>
      <!-- todo : if the article has more than 5 co-authors (too long, won't fit) , "la team elao" is the author -->
      <div class="article-author">
        <div class="article-author__image">
          <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
        </div>
        <span class="article-author__info">Écrit par <strong>La team elao</strong></span>
      </div>
      <div class="article-info__date">
        <span>Publication <strong>4 mai 2012</strong></span>
        <span>Modification <strong>24 septembre 2020</strong></span>
      </div>
    </div>

    <div class="article-header">
      <h1>Migrer un site web sans interruption de service grâce au reverse proxy d&#039;Apache.</h1>
      <p>Migrer un site web sans interruption de service grâce au reverse proxy d&#039;Apache.</p>
      <ul class="article-tag-list">
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/35/blog/tag/Apache">#Apache</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/35/blog/tag/Linux">#Linux</a>
          </li>
                  <li class="article-tag-list__item">
            <a href="/elao_/pr/35/blog/tag/Trucs%20et%20astuces">#Trucs et astuces</a>
          </li>
              </ul>
    </div>
  </div>

  <ul class="table-of-content">
    <li class="table-of-content__item">
      <a href="#intro">Introduction</a>
    </li>
    <li class="table-of-content__item">
      <a href="#quas">Quas odio atque</a>
    </li>
    <li class="table-of-content__item">
      <a href="voluptatem">Voluptatem et amet atque</a>
    </li>
  </ul>

  <div class="article-content">
    <main class="article-content__main">
      <body><p>Bonjour à tous,</p>
<p>petit mémo aujourd'hui concernant la migration d'une application web d'un (ancien) serveur vers un nouveau serveur.
Tout admin système à été, un jour ou l'autre, confronté à la problématique du "downtime" ou en bon français de l'interruption de service lors du "déménagement" d'une application web vers une nouvelle machine.</p>
<p>En effet dans le cas de la modification d'un pointage DNS, celui-ci peut mettre plusieurs heures, voir même une journée à se propager sur les différents serveurs de noms.
Pour un site statique cela ne pose guère de problème puisque nous sommes dans une stratégie de lecture, par contre pour un site dynamique le délai de propagation peut-être hautement problématique. Il est évident que l'on ne peut se permettre d'avoir des écritures sur l'un et l'autre des serveurs.</p>
<p>Une bonne habitude pour minimiser ce problème est d'utiliser les systèmes d'IP failover, qui permettent d'éviter de faire une modification au niveau du nom de domaine concerné lors d'une migration applicative.</p>
<blockquote>
<p>Les IP failover sont, pour résumer, des interfaces "virtuelles" qui peuvent être facilement redirigées vers une machine physique, OVH propose par exemple ce système sur tous ses serveurs dédiés. Grâce à celles-ci, la problématique du downtime se pose moins, en effet une fois que notre site a été "déménagé", il suffit de modifier le pointage de cette IP failover sans impact sur le pointage des DNS.</p>
</blockquote>
<p><strong>Cette stratégie trouve par contre ses limites dans différents cas :</strong></p>
<ul><li>Si l'on est dans le cas d'un serveur mutualisé (qui n'héberge donc pas qu'une seule application).</li>
<li>S'il est impossible de faire un transfert complet des différents sites en même temps.</li>
<li>Si l'on ne souhaite tout simplement "déménager" qu'une seule application</li>
</ul><p>Dans le cas d'applications à l'architecture complexe pour lesquelles il est quasiment impossible d'assurer le transfert applicatif en une seule fois. On se retrouve donc souvent avec une partie des applications sur la nouvelle machine et le reste sur l'ancienne.</p>
<p>Il est heureusement possible de se servir des serveurs web comme de "reverse proxy".
Dans le cadre de ce mémo nous utiliseront <a href="http://httpd.apache.org/" title="Apache" target="_blank">Apache</a> mais il est également possible d'utiliser <a href="http://nginx.com/" title="Nginx" target="_blank">Nginx</a>, voir même <a href="http://www.squid-cache.org/" title="Squid" target="_blank">Squid</a> qui doit être capable de faire du reverse proxy.</p>
<p><strong>Nous partirons du principe que :</strong></p>
<ul><li>Votre (vos) application(s) et base(s) de données ont été transférées sur leur nouveau serveur, que tout fonctionne et que tout a été vérifié par qui de droit.</li>
<li>Un nouveau "Virtual Host" (désolé ça ne veux pas avec "Hôte virtuel" ...), a été configuré et est fonctionnel.</li>
<li>Les mods <code class="code-inline" id="431387eb7262e1cfc79b125eb8a67c60">proxy</code> et <code class="code-inline" id="21ca3d34bc556c5e2aa77fdbfb78a618">[proxy_http][4]</code> sont "chargés" par Apache sur notre serveur d'origine.</li>
<li>Le site à déplacer sera <code class="code-inline" id="e7cbcfb06a5b315657e7f06281d1aed3">www.my-domain.com</code>.</li>
<li>L'IP du "nouveau" serveur sera XXX.XXX.XXX.XXX</li>
</ul><p><strong>Tout le reste se passe du coté de "l'ancien" serveur, nous commencerons par modifier la résolution de nom local concernant le domaine concerné en éditant le fichier <code class="code-inline" id="ad942c725cd0cae65ca4c63717ec464c">/etc/hosts</code> pour y rajouter l'entrée suivante :</strong></p>
<blockquote>
<p>XXX.XXX.XXX.XXX www.my-domain.com</p>
</blockquote>
<p>De cette façon nous forçons le pointage de notre domaine vers la nouvelle machine uniquement pour le serveur d'origine.</p>
<p><strong>Nous allons ensuite modifier le "virtual host" original en y ajoutant les lignes suivantes :</strong></p>
<pre class="code-multiline language-apacheconf"><code class="language-apacheconf" id="8b40ac982f6b1701cbdba8da413ac273"><span class="token directive-inline property">ProxyRequests</span> Off
<span class="token directive-block tag"><span class="token directive-block tag"><span class="token punctuation">&lt;</span>Proxy</span><span class="token directive-block-parameter attr-value"> *</span><span class="token punctuation">&gt;</span></span>
  <span class="token directive-inline property">Order</span> <span class="token directive-inline property">deny</span>,allow
  <span class="token directive-inline property">Allow</span> from all
<span class="token directive-block tag"><span class="token directive-block tag"><span class="token punctuation">&lt;/</span>Proxy</span><span class="token punctuation">&gt;</span></span>

<span class="token directive-inline property">ProxyPass</span> / http://www.my-domain.com/
<span class="token directive-inline property">ProxyPassReverse</span> / http://www.my-domain.com/</code></pre>
<p>Il suffit, pour finir, de redémarrer Apache, le traffic est à présent redirigé vers le nouveau serveur de manière transparente pour l'internaute.
Nous pouvons dès lors demander la redirection du nom de domaine vers l'IP du "nouveau" serveur sans se soucier des délais de propagation des serveurs de noms.</p>
<p>Une fois tout cela terminé jetez de temps en temps un oeil à vos logs sur le serveur d'origine, une fois que vous constatez que plus aucun traffic n'arrive sur votre ancien serveur c'est que le nom de domaine a été propagé.</p></body>
    </main>
    <aside class="article-content__aside">
      <button class="kudo">
        <span class="kudo__button" aria-hidden="true"></span>
        <span class="screen-reader">Cet article m’a été utile</span>
        <span class="kudo__label" aria-hidden="true">Kudos</span>
      </button>
    </aside>
  </div>

  <div class="article-footer">
    <!-- If the article has one single author -->
    <div class="article-author">
      <div class="article-author__image">
        <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
      </div>
      <span class="article-author__info">Écrit par<strong>Guewen FAIVRE</strong></span>
      <div class="article-author__social">
                  <a href=guewen_faivre class="social social--small">
            <i class="icon icon--twitter" aria-hidden="true"></i>
            <span class="screen-reader">Compte twitter de Guewen FAIVRE</span>
          </a>
                          <a href=gfaivre class="social social--small">
            <i class="icon icon--github" aria-hidden="true"></i>
            <span class="screen-reader">Compte github de Guewen FAIVRE</span>
          </a>
                          <a href=http://www.elao.com class="social social--small">
            <i class="icon icon--website" aria-hidden="true"></i>
            <span class="screen-reader">Site personnel de Guewen FAIVRE</span>
          </a>
              </div>
    </div>
    <!-- If the article has mutltiple authors -->
    <div class="article-author">
      <div class="article-author__image">
        <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
      </div>
      <span class="article-author__info">Co-auteur<strong>Guewen FAIVRE</strong></span>
      <div class="article-author__social">
                  <a href=guewen_faivre class="social social--small">
            <i class="icon icon--twitter" aria-hidden="true"></i>
            <span class="screen-reader">Compte twitter de Guewen FAIVRE</span>
          </a>
                          <a href=gfaivre class="social social--small">
            <i class="icon icon--github" aria-hidden="true"></i>
            <span class="screen-reader">Compte github de Guewen FAIVRE</span>
          </a>
                          <a href=http://www.elao.com class="social social--small">
            <i class="icon icon--website" aria-hidden="true"></i>
            <span class="screen-reader">Site personnel de Guewen FAIVRE</span>
          </a>
              </div>
    </div>
    <div class="article-author">
      <div class="article-author__image">
        <img src="/elao_/pr/35/images/authors/gfaivre.jpg" />
      </div>
      <span class="article-author__info">Co-auteur<strong>Guewen FAIVRE</strong></span>
      <div class="article-author__social">
                  <a href=guewen_faivre class="social social--small">
            <i class="icon icon--twitter" aria-hidden="true"></i>
            <span class="screen-reader">Compte twitter de Guewen FAIVRE</span>
          </a>
                          <a href=gfaivre class="social social--small">
            <i class="icon icon--github" aria-hidden="true"></i>
            <span class="screen-reader">Compte github de Guewen FAIVRE</span>
          </a>
                          <a href=http://www.elao.com class="social social--small">
            <i class="icon icon--website" aria-hidden="true"></i>
            <span class="screen-reader">Site personnel de Guewen FAIVRE</span>
          </a>
              </div>
    </div>
  </div>

  
        </main>
                    <footer class="footer">
                <section class="footer__links">
                    <p class="h1 h1--small">
                        elao
                        <span>développe</span>
                         <span>du lien</span>
                    </p>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="#">Nos services</a>
                            </li>
                            <li>
                                <a href="#">Nos études de cas</a>
                            </li>
                            <li>
                                <a href="#">Blog</a>
                            </li>
                            <li>
                                <a href="#">Notre méthodologie</a>
                            </li>
                            <li>
                                <a href="#">La tribu</a>
                            </li>
                            <li>
                                <a href="#">Contact</a>
                            </li>
                            <li>
                                <a href="#">Nos valeurs</a>
                            </li>
                            <li>
                                <a href="#">Nous recrutons <span class="bullet">3</span></a>
                            </li>
                        </ul>
                    </div>
                    <div class="socials">
                        <ul>
                            <li>
                                <a href="#">
                                    <i class="icon icon--github"></i>
                                    Github
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--twitter"></i>
                                    Twitter
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icon icon--instagram"></i>
                                    Instagram
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <section class="footer__legals">
                    <span>© 2014/2020 - ELAO - Tous droits réservés</span>
                    <a href="#">Mentions légales</a>
                    <a href="#">Protection des données</a>
                </section>
            </footer>
        </div>
                            <script src="/elao_/pr/35/build/runtime.27a2bcc8.js"></script><script src="/elao_/pr/35/build/app.a7244376.js"></script>
                    </body>
</html>
