<!DOCTYPE html>
<html lang="fr" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Le Design Pattern &#039;Decorator&#039;</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/elao_/pr/338/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/elao_/pr/338/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/elao_/pr/338/favicon-16x16.png">
        <link rel="manifest" href="/elao_/pr/338/site.webmanifest">
        <link rel="mask-icon" href="/elao_/pr/338/safari-pinned-tab.svg" color="#ff4344">
        <link rel="shortcut icon" href="/elao_/pr/338/favicon.ico">
        <meta name="msapplication-TileColor" content="#ff4344">
        <meta name="msapplication-config" content="/elao_/pr/338/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

                    <meta name="description" content="Présentation du pattern &#039;Decorator&#039; dans le cadre d&#039;une série consacrée aux Design Patterns" />
            <link rel="canonical" href="https://elao.github.io/elao_/pr/338/blog/dev/design-pattern-decorator" />

            <!-- Open Graph / Facebook -->
            <meta property="og:title" content="Le Design Pattern &#039;Decorator&#039;" />
            <meta property="og:locale" content="fr" />
            <meta property="og:description" content="Présentation du pattern &#039;Decorator&#039; dans le cadre d&#039;une série consacrée aux Design Patterns" />
            <meta property="og:url" content="https://elao.github.io/elao_/pr/338/blog/dev/design-pattern-decorator" />
            <meta property="og:site_name" content="elao_" />
                                        <meta property="og:image" content="/elao_/pr/338/images/posts/thumbnails/decorator_pattern.jpg">
            
            <!-- Twitter -->
            <meta property="twitter:card" content="summary_large_image">
            <meta property="twitter:title" content="Le Design Pattern &#039;Decorator&#039;">
            <meta property="twitter:description" content="Présentation du pattern &#039;Decorator&#039; dans le cadre d&#039;une série consacrée aux Design Patterns">
            <meta property="twitter:site" content="@elao">
            <meta property="twitter:creator" content="@elao">
                                        <meta property="twitter:image" content="https://elao.github.io/elao_/pr/338/images/posts/thumbnails/decorator_pattern.jpg">
                    
                            <meta name="robots" content="noindex" />
        
        <script>
                        document.querySelector('html').classList.remove('no-js');
        </script>

                    <link rel="stylesheet" href="/elao_/pr/338/build/style.ddc1d4b6.css">
        
            </head>
    <body>
        <header class="header">
            <div class="container">
                                    <!--
                        Todo :
                        - only on homepage : on scroll .logo.logo--animated becomes .logo.logo--animated.logo--active (triggers its animation)
                     -->
                    <a href="/elao_/pr/338/">
                        <span class="screen-reader">Le Design Pattern &#039;Decorator&#039;</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                                            </a>
                
                                    <!-- Desktop nav -->
                    <nav class="nav">
                        <ul>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/338/nos-services">
                                                                                <span>Services</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/338/methodologie">
                                                                                <span>Méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/338/etudes-de-cas">
                                                                                <span>Études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/338/nos-valeurs">
                                                                                <span>Valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/338/la-tribu">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/338/blog">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav__item">
                                    <a href="/elao_/pr/338/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                
                                    <!-- Mobile nav -->
                    <nav class="nav-mobile">
                        <div class="nav-mobile__header">
                            <a href="/elao_/pr/338/">
                                                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 100" class="logo logo--animated">
                                <path d="M61.6,61.6H19.7C21,69,24.8,72.2,32.6,72.2c5.9,0,8.8-1.9,11.7-7.8l16.1,6.9C56.2,82,46.9,87.8,32.1,87.8
                                    c-19.1,0-32-12.6-32-31.6c0-19.5,12.6-32.6,31.4-32.6c18.1,0,30.3,12.6,30.3,31.6C61.7,57.2,61.7,58.9,61.6,61.6z M19.6,49.3h23.6
                                    c-0.2-7.9-4.1-10.9-11.3-10.9S20.7,41.8,19.6,49.3z"/>
                                <path d="M71.2,0.1H90v86.5H71.2V0.1z"/>
                                <path d="M166.1,24.7v61.8h-18.8V72.7c-3.5,9.8-10.5,15.1-20.4,15.1c-17.7,0-27.4-12.9-27.4-32
                                    c0-19.4,9.3-32.2,26.2-32.2c10.5,0,18,5.4,21.6,15.6V24.7H166.1z M147.9,55.7c0-10.4-4.8-15.2-15.1-15.2c-9.9,0-14.6,4.8-14.6,15.2
                                    c0,10.1,4.7,14.9,14.6,14.9C143.1,70.7,147.9,65.9,147.9,55.7L147.9,55.7z"/>
                                <path d="M242.8,55.8c0,19.9-15.3,32-33.6,32s-33.6-12.1-33.6-32s15.3-32.2,33.6-32.2S242.8,35.8,242.8,55.8z M224,55.8
                                    c0-10.4-4.7-15.2-14.8-15.2c-10.1,0-14.8,4.8-14.8,15.2c0,10.1,4.7,14.9,14.8,14.9S224,65.9,224,55.8L224,55.8z"/>
                                <rect x="243.1" y="86.5" width="56.7" height="15"/>
                            </svg>
                        
                            </a>
                            <button class="nav-toggle nav-toggle--close">
                                <i class="icon icon--close" aria-hidden="true"></i>
                                <span class="screen-reader">Fermer le menu</span>
                            </button>
                        </div>
                        <ul>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/338/nos-services">
                                                                                <span>Services</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/338/methodologie">
                                                                                <span>Méthodologie</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/338/etudes-de-cas">
                                                                                <span>Études de cas</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/338/nos-valeurs">
                                                                                <span>Valeurs</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/338/la-tribu">
                                                                                <span>La tribu</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item ">
                                    <a href="/elao_/pr/338/blog">
                                                                                <span>Blog</span>
                                    </a>
                                </li>
                                                            <li class="nav-mobile__item nav-mobile__item--large">
                                    <a href="/elao_/pr/338/contact">
                                                                                    <i class="icon icon--contact" aria-hidden="true"></i>
                                                                                <span>Contact</span>
                                    </a>
                                </li>
                                                    </ul>
                    </nav>
                    <button class="nav-toggle nav-toggle--open">
                        <i class="icon icon--hamburger" aria-hidden="true"></i>
                        <span class="screen-reader">Ouvrir le menu</span>
                    </button>
                            </div>
        </header>
        <div class="container">
        <main>
                <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
        <li class="breadcrumb__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="/elao_/pr/338/blog">
                <span itemprop="name">Blog</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>
        <li class="breadcrumb__item"  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a itemprop="item" href="#">
                <span itemprop="name">Le Design Pattern &#039;Decorator&#039;</span>
            </a>
            <meta itemprop="position" content="2" />
        </li>
    </ol>

    <div class="article-banner">
        <div class="article-banner__cover" style="background: #f1f1f1 url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/dea4e7cf378fbd55a35980cc243d48a7.jpg');
    background: #f1f1f1 -webkit-image-set(
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/dea4e7cf378fbd55a35980cc243d48a7.jpg') 1x,
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/22178506454e6b7e48770bd2fd3dd72c.jpg') 2x
    );
    background: #f1f1f1 -moz-image-set(
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/dea4e7cf378fbd55a35980cc243d48a7.jpg') 1x,
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/22178506454e6b7e48770bd2fd3dd72c.jpg') 2x
    );
    background: #f1f1f1 -ms-image-set(
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/dea4e7cf378fbd55a35980cc243d48a7.jpg') 1x,
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/22178506454e6b7e48770bd2fd3dd72c.jpg') 2x
    );
    background: #f1f1f1 image-set(
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/dea4e7cf378fbd55a35980cc243d48a7.jpg') 1x,
        url('/elao_/pr/338/resized/images/posts/headers/decorator_pattern.jpg/22178506454e6b7e48770bd2fd3dd72c.jpg') 2x
    );" data-aos="fade-down"></div>

        <div class="article-info" data-aos="zoom-in">
                                        <div class="article-author ">
                    <div class="article-author__image">
                                                    <a href="/elao_/pr/338/la-tribu/xavierr">
                                <img     src="/elao_/pr/338/resized/images/members/avatars/xavierr.jpg/f7c981f2a5a267769cb7aac523f4bfbe.jpg"
    srcset="
        /elao_/pr/338/resized/images/members/avatars/xavierr.jpg/f7c981f2a5a267769cb7aac523f4bfbe.jpg 1x,
        /elao_/pr/338/resized/images/members/avatars/xavierr.jpg/db27f9e9e492322fd5a26c3de6a5c7d4.jpg 2x
    "
 />
                            </a>
                                            </div>
                    <span class="article-author__info">
                    Écrit par
                                            <a href="/elao_/pr/338/la-tribu/xavierr">
                            <strong>Xavier R</strong>
                        </a>
                                      </span>
                </div>
                        <div class="article-info__date">
                <span>Publication <strong>4 mai 2017</strong></span>
                            </div>
        </div>

        <div class="article-header" data-aos="zoom-in-up">
            <h1>Le Design Pattern &#039;Decorator&#039;</h1>
            <p>Présentation du pattern &#039;Decorator&#039; dans le cadre d&#039;une série consacrée aux Design Patterns</p>
            <ul class="article-tag-list">
                                    <li class="article-tag-list__item">
                        <a href="/elao_/pr/338/blog/tag/design-pattern" rel="nofollow">#DesignPattern</a>
                    </li>
                                    <li class="article-tag-list__item">
                        <a href="/elao_/pr/338/blog/tag/conception" rel="nofollow">#Conception</a>
                    </li>
                            </ul>
        </div>
    </div>

    
    <div class="article-content">
        <main class="article-content__main">

            
            <body><p>Le <em>Gang of Four</em> a classé les design patterns dans trois catégories : les DP de création, les DP structurels et les DP comportementaux (<em>behavior</em>).</p>
<p>Au début de cette série, nous avons abordé deux design patterns de création : la <a href="/elao_/pr/338/blog/dev/design-pattern-factory-method"><code class="code-inline" id="d021d5f9d4069111c20ea6ad534fd22c">Factory Method</code></a> et le pattern <a href="/elao_/pr/338/blog/dev/design-pattern-abstract-factory"><code class="code-inline" id="3266b075d74acc656ed95e166300fd26">Abstract Factory</code></a>. Je vous propose aujourd'hui de nous pencher sur notre premier design pattern structurel : le <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code>.</p>
<p>Il y sera notamment question de modération, de sexe et de grossièretés. Autant de bonnes raisons de poursuivre votre lecture.</p>
<h2 id="classification" class="anchor-title"><a href="#classification">Classification</a></h2>
<p>Le <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code> appartient à la famille des <strong>design patterns structurels</strong>.</p>
<h2 id="definition" class="anchor-title"><a href="#definition">Définition</a></h2>
<blockquote>
<p>Attach additional responsibilities to an object dynamically. Decorators provide a flexible alternative to subclassing for extending functionality.</p>
</blockquote>
<p>Que nous apprend cette définition (GoF) ? Elle nous apprend que le Design Pattern <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code> permet d'ajouter <strong>dynamiquement</strong> des responsabilités à un objet existant et que cette solution apporte plus de <strong>souplesse</strong> que l'héritage.</p>
<p>Nous allons donc nous efforcer de démontrer ses avantages par rapport à l'héritage.</p>
<p>Noter que le terme <code class="code-inline" id="e229a672e0df4c202a248ad2e24adab8">Wrapper</code> est un synonyme de <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code> (GoF).</p>
<h2 id="diagramme-du-design-pattern-decorator" class="anchor-title"><code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code><a href="#diagramme-du-design-pattern-decorator">Diagramme du Design pattern </a></h2>
<figure>
    <img src="/elao_/pr/338/images/posts/design-pattern/structural-decorator.jpg" alt="Le Design Pattern 'Decorator'" id="le-design-pattern-decorator">
    <figcaption>
      <span class="figure__legend">Le Design Pattern 'Decorator'</span>
    </figcaption>
</figure>
<h2 id="participants" class="anchor-title"><a href="#participants">Participants</a></h2>
<ul>
<li><strong>Component</strong> est une interface qu'implémentent à la fois l'objet décoré et les objets qui le décorent</li>
<li><strong>ConcreteComponent</strong> représente l'objet décoré (qui implémente <code class="code-inline" id="2cb05e4bb7830be982f0922fed86b4cd">Component</code>)</li>
<li><strong>Decorator</strong> représente l'interface des décorateurs</li>
<li>On trouve ensuite les décorateurs concrets (<strong>ConcreteDecoratorA</strong>, etc.)</li>
</ul>
<h2 id="expose-du-cas-concret-sexe-et-violence-a-tous-les-etages" class="anchor-title"><a href="#expose-du-cas-concret-sexe-et-violence-a-tous-les-etages">Exposé du cas concret (sexe et violence à tous les étages)</a></h2>
<p>Nous allons à présent nous attacher à montrer l'implémentation de ce Design Pattern à travers un cas concret.</p>
<p>Vous avez développé une application Web qui met en relation des vendeurs et des acheteurs. Vous mettez à disposition des utilisateurs une messagerie privée qui permet aux acheteurs et aux vendeurs de communiquer.</p>
<p>Votre application rencontre un franc succès mais des dérives ont été constatées dans l'utilisation de la messagerie (spam, injures, etc.). Il apparaît donc nécessaire de développer un système de modération, automatisé compte tenu des volumes d'échanges à traiter.</p>
<p>Voici le code de la classe responsable de la modération :</p>
<pre class="code-multiline language-php"><code class="language-php" id="2dda0e552cc92b28342b3f2b1ef6535e"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">interface</span> <span class="token class-name">ModeratorInterface</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">moderate</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Moderator</span> <span class="token keyword">implements</span> <span class="token class-name">ModeratorInterface</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$replacements</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$replacements</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">replacements</span> <span class="token operator">=</span> <span class="token variable">$replacements</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">moderate</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">replacements</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Exemple d'utilisation :</p>
<pre class="code-multiline language-php"><code class="language-php" id="e2a4adfd1ad2abdba50abf221864444f"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$replacements</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'abruti'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'individu aux capacités intellectuelles limitées'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'nique ta mère'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'poutou à ta maman'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token variable">$moderator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Moderator</span><span class="token punctuation">(</span><span class="token variable">$replacements</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$moderator</span><span class="token operator">-&gt;</span><span class="token function">moderate</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nique ta mère\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Affiche 'poutou à ta maman'</span></span></code></pre>
<p>Cependant, les administrateurs de l'application se sont aperçus que certains vendeurs profitaient de la messagerie privée pour communiquer leurs coordonnées aux acheteurs afin de traiter en direct et ainsi passer outre les commissions versées au site.</p>
<p>Il nous faut donc renforcer le système de modération pour empêcher les vendeurs de communiquer leurs coordonnées via la messagerie. L'occasion de voir comment le Design Pattern <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code> va nous permettre d'enrichir la modération tout en conservant une certaine souplesse.</p>
<h2 id="le-pattern-decorator-en-action" class="anchor-title"><code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code> en action<a href="#le-pattern-decorator-en-action">Le pattern </a></h2>
<p>Nous allons rédiger une classe qui va ajouter des fonctionnalités de modération en décorant notre classe initiale <code class="code-inline" id="ca65a68e10b3c65ac897ff8b89f9f728">Moderator</code> :</p>
<pre class="code-multiline language-php"><code class="language-php" id="1878f22fcb86c4054ed3942db2903506"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">PhoneNumberModerator</span> <span class="token keyword">implements</span> <span class="token class-name">ModeratorInterface</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name">ModeratorInterface</span> */</span>
    <span class="token keyword">private</span> <span class="token variable">$decorated</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">private</span> <span class="token variable">$phonePattern</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/[0-9]{10}/'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ModeratorInterface</span> <span class="token variable">$baseModerator</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">decorated</span> <span class="token operator">=</span> <span class="token variable">$baseModerator</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">moderate</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>
            <span class="token scope"><span class="token keyword">self</span><span class="token punctuation">::</span></span><span class="token variable">$phonePattern</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'**********'</span><span class="token punctuation">,</span>
            <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">decorated</span><span class="token operator">-&gt;</span><span class="token function">moderate</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Cette classe <code class="code-inline" id="adfd9f2d77d22c1fb7de0f2f67ad6df4">PhoneNumberModerator</code> permet d'obfusquer les numéros de téléphone. Elle accepte en argument de son constructeur une instance de ModeratorInterface qu'elle décore.</p>
<p>Exemple d'utilisation :</p>
<pre class="code-multiline language-php"><code class="language-php" id="ea8e871356ac3deb4271f792fdcbc700"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

    <span class="token variable">$moderator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhoneNumberModerator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Moderator</span><span class="token punctuation">(</span><span class="token variable">$replacements</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$moderator</span><span class="token operator">-&gt;</span><span class="token function">moderate</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nique ta mère ; appelez-nous au 0600000000.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Affiche : "poutou à ta maman ; appelez-nous au **********."</span></span></code></pre>
<p>Il nous faudra également obfusquer les adresses email et il convient donc de rédiger une classe <code class="code-inline" id="464aabe56253d3454fe6e72f0e09b705">EmailAddressModerator</code> (assez similaire à <code class="code-inline" id="adfd9f2d77d22c1fb7de0f2f67ad6df4">PhoneNumberModerator</code>).</p>
<p>Le code pour instancier les services modérateurs devient donc :</p>
<pre class="code-multiline language-php"><code class="language-php" id="f1e4fa323ca04ed244a1771b504f7f0b"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token variable">$moderator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EmailAddressModerator</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">PhoneNumberModerator</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Moderator</span><span class="token punctuation">(</span><span class="token variable">$replacements</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<h2 id="avantages-du-pattern-decorator-par-rapport-a-l-heritage" class="anchor-title"><code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code> par rapport à l'héritage<a href="#avantages-du-pattern-decorator-par-rapport-a-l-heritage">Avantages du pattern </a></h2>
<p>Supposons que nous soyons passés par l'héritage pour enrichir notre service de modération, ce qui nous donnerait :</p>
<p><strong>PhoneNumberModerator</strong> hérite de <strong>EmailAddressModerator</strong> qui hérite de <strong>Moderator</strong>.</p>
<p>Outre le fait que la chaîne d'héritage semble un peu forcée (pourquoi <strong>PhoneNumberModerator</strong> hériterait de <strong>EmailAddressModerator</strong> ?), la solution de l'héritage manque de souplesse. En effet, ici, utiliser <strong>PhoneNumberModerator</strong> implique nécessairement d'utiliser <strong>EmailAddressModerator</strong>. Il n'est pas possible d'utiliser nos services <em>à la carte</em>, ce que permet le pattern <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code>.</p>
<p>En effet, grâce au pattern <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code>, toutes les combinaisons de services modérateurs sont possibles, ce que ne permet pas l'héritage (conception <em>dynamique</em> vs <em>statique</em>).</p>
<p>Autre avantage du pattern, le chaînage des décorateurs est potentiellement extensible à l'infini. Il est ainsi très facile d'ajouter une nouvelle classe de modération sans qu'il soit nécessaire de modifier la hiérarchie d'héritage.</p>
<p>Enfin, comme la chaîne des décorateurs est construite de manière dynamique lors de leur instanciation, il est possible d'introduire des services de manière conditionnelle. Par exemple, on pourrait ajouter un service de modération qui bannirait les expressions à caractère sexuel, uniquement si l'utilisateur courant est mineur.</p>
<p>Au final, cet exemple est une parfaite illustration de l'avantage de la composition sur l'héritage.</p>
<h2 id="autres-usages-du-pattern-decorator" class="anchor-title"><code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code><a href="#autres-usages-du-pattern-decorator">Autres usages du pattern </a></h2>
<p>Le design pattern <code class="code-inline" id="5041ffe849fcde6f23f9d99c2e949265">Decorator</code> est également très utilisé pour ajouter des fonctionnalités de cache à des services existants.</p>
<p>C'est notamment le cas de la classe <a href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpKernel/HttpCache/HttpCache.php" target="_blank"><code class="code-inline" id="cbd8f4eaaa6db9d6087aaea4351b469a">HttpCache</code></a> de Symfony :</p>
<pre class="code-multiline language-php"><code class="language-php" id="79d176c4b6772dc4fc152470c2e0d61c"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
        <span class="token variable">$kernel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppKernel</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'prod'</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// AppCache hérite de HttpCache:</span>
        <span class="token variable">$kernel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppCache</span><span class="token punctuation">(</span><span class="token variable">$kernel</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p>Source : <a href="http://symfony.com/doc/current/http_cache.html#symfony-reverse-proxy" target="_blank">http://symfony.com/doc/current/http_cache.html#symfony-reverse-proxy</a></p>
<p>La classe <code class="code-inline" id="22554c2f3f431fa4243965df392b9ea9">AppCache</code> de Symfony implémente l'interface <code class="code-inline" id="0c1e20bd8106272498d98bc2dab30ac5">HttpKernelInterface</code> (via son parent <code class="code-inline" id="cbd8f4eaaa6db9d6087aaea4351b469a">HttpCache</code>), tout comme la classe <code class="code-inline" id="3caeb9565027419ea673f2f760ededf0">AppKernel</code> qu'elle décore.</p></body>
                                                </main>
        <aside class="article-content__aside">
                    </aside>
    </div>

    <div class="article-footer" data-aos="fade-in">
                                    <div class="article-author">
                    <div class="article-author__image">
                        <a href="/elao_/pr/338/la-tribu/xavierr">
                            <img     src="/elao_/pr/338/resized/images/members/avatars/xavierr.jpg/f7c981f2a5a267769cb7aac523f4bfbe.jpg"
    srcset="
        /elao_/pr/338/resized/images/members/avatars/xavierr.jpg/f7c981f2a5a267769cb7aac523f4bfbe.jpg 1x,
        /elao_/pr/338/resized/images/members/avatars/xavierr.jpg/db27f9e9e492322fd5a26c3de6a5c7d4.jpg 2x
    "
 />
                        </a>
                    </div>
                    <span class="article-author__info">
                        Écrit par
                        <a href="/elao_/pr/338/la-tribu/xavierr">
                            <strong>Xavier R</strong>
                        </a>
                    </span>

                    <div class="article-author__social">
                                                                            <a href="https://github.com/xavier-rdo " class="social social--small">
                                <i class="icon icon--github" aria-hidden="true"></i>
                                <span class="screen-reader">Compte github de Xavier R</span>
                            </a>
                                                                    </div>
                </div>
                        </div>

            <div class="bricks">
            
                            <div class="brick-contribute">
                    <p>
                        Une typo ?
                        <a href="https://github.com/Elao/elao_/edit/better-buttons/content/blog/dev/design-pattern-decorator.md/" target="_blank" class="animated-link animated-link--light">
                            Modifier cet article sur Github
                        </a>
                    </p>
                </div>
                    </div>
            </main>
                    <footer class="footer">
                <section class="footer__links">
                    <p class="h1">
                        elao
                        <span>développe</span>
                         <span>du lien</span>
                    </p>
                    <div class="links">
                                                    <ul>
                                                            <li>
                                    <a href="/elao_/pr/338/nos-services">Services</a>
                                </li>
                                                            <li>
                                    <a href="/elao_/pr/338/methodologie">Méthodologie</a>
                                </li>
                                                            <li>
                                    <a href="/elao_/pr/338/etudes-de-cas">Études de cas</a>
                                </li>
                                                        </ul>
                                                    <ul>
                                                            <li>
                                    <a href="/elao_/pr/338/nos-valeurs">Valeurs</a>
                                </li>
                                                            <li>
                                    <a href="/elao_/pr/338/la-tribu">La tribu</a>
                                </li>
                                                            <li>
                                    <a href="/elao_/pr/338/blog">Blog</a>
                                </li>
                                                        </ul>
                                                    <ul>
                                                            <li>
                                    <a href="/elao_/pr/338/contact">Contact</a>
                                </li>
                                                        </ul>
                                                <ul>
                            <li>
                                                                <a href="/elao_/pr/338/recrutement">
                                    Nous recrutons
                                                                            <span class="bullet">1</span>
                                                                    </a>
                            </li>
                        </ul>
                    </div>
                    <div class="socials">
                        <ul>
                            <li>
                                <a href="https://github.com/elao" target="_blank">
                                    <i class="icon icon--github"></i>
                                    Github
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/elao" target="_blank">
                                    <i class="icon icon--twitter"></i>
                                    Twitter
                                </a>
                            </li>
                            <li>
                                <a href="https://www.instagram.com/hello_elao_/" target="_blank">
                                    <i class="icon icon--instagram"></i>
                                    Instagram
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>
                <section class="footer__legals">
                    <span>© 2005 - 2021 - ELAO - Tous droits réservés</span>
                    <a href="/elao_/pr/338/legal">Mentions légales</a>
                    <a href="/elao_/pr/338/confidentialite">Protection des données</a>
                </section>
            </footer>
        </div>
                                <script src="/elao_/pr/338/build/runtime.67ea16f5.js" defer></script><script src="/elao_/pr/338/build/40.38998a60.js" defer></script><script src="/elao_/pr/338/build/app.118167f3.js" defer></script>
        

        </body>
</html>
